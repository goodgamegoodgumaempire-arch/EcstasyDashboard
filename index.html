<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
  import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA40DfthDKIy812oujRj2JLLg1Y_dCvJvI",
    authDomain: "ecstassy-44277.firebaseapp.com",
    projectId: "ecstassy-44277",
    storageBucket: "ecstassy-44277.firebasestorage.app",
    messagingSenderId: "557171186889",
    appId: "1:557171186889:web:0cae151137b761b2660118",
    measurementId: "G-34Q8PVK8EH"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const database = getDatabase(app);

  const content = document.getElementById("content");
  const authModal = document.getElementById("authModal");

  // Ascunde conținutul site-ului până la login
  content.style.display = "none";
  authModal.style.display = "flex";

  // Verifică dacă utilizatorul este logat
  onAuthStateChanged(auth, user => {
    if(user) {
      // User logat -> arată conținutul
      authModal.style.display = "none";
      content.style.display = "block";
    } else {
      // Nu e logat -> ascunde conținutul
      authModal.style.display = "flex";
      content.style.display = "none";
    }
  });

  // Register
  window.registerUser = () => {
    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPassword").value;
    const name = document.getElementById("regName").value;

    createUserWithEmailAndPassword(auth, email, password)
      .then(userCredential => {
        const user = userCredential.user;

        // Setează numele în profil
        updateProfile(user, { displayName: name });

        // Salvează user-ul în Realtime Database
        set(ref(database, 'users/' + user.uid), {
          username: name,
          email: email
        });

      })
      .catch(error => alert(error.message));
  };

  // Login
  window.loginUser = () => {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    signInWithEmailAndPassword(auth, email, password)
      .catch(error => alert(error.message));
  };

  // Logout
  window.logoutUser = () => {
    signOut(auth);
  };
</script>
